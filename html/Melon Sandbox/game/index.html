<!DOCTYPE html>

<html lang="en-us">
<head><meta content="child-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com; connect-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.eponesh.com *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.gameanalytics.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.unity3d.com *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.net *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de wss://*.api.gameanalytics.com:* wss://*.cdp.cloud.unity3d.com:* wss://*.cloud-api.yandex.net:* wss://*.eponesh.com:* wss://*.firebase.googleapis.com:* wss://*.firebasestorage.googleapis.com:* wss://*.firestore.googleapis.com:* wss://*.games-sdk.yandex.ru:* wss://*.gstatic.com:* wss://*.hippogames.dev:* wss://*.oauth2.googleapis.com:* wss://*.openidconnect.googleapis.com:* wss://*.playmelonpg.com:* wss://*.s3.eu-central-1.amazonaws.com:* wss://*.storage.yandex.net:* wss://api.gameanalytics.com:* wss://cdp.cloud.unity3d.com:* wss://cloud-api.yandex.net:* wss://firebase.googleapis.com:* wss://firebasestorage.googleapis.com:* wss://firestore.googleapis.com:* wss://games-sdk.yandex.ru:* wss://gstatic.com:* wss://hippogames.dev:* wss://oauth2.googleapis.com:* wss://openidconnect.googleapis.com:* wss://playmelonpg.com:* wss://s3.eu-central-1.amazonaws.com:* wss://storage.yandex.net:* www.google-analytics.com www.googletagmanager.com yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yandexmetrica.com yango.com yastatic.net; default-src 'self' *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gstatic.com *.hippogames.dev *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net api.gameanalytics.com cdp.cloud.unity3d.com cloud-api.yandex.net firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gstatic.com hippogames.dev oauth2.googleapis.com openidconnect.googleapis.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net; font-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com fonts.gstatic.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com yastat.net yastatic.net; frame-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com cdp.cloud.unity3d.com cloud-api.yandex.net firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com localhost oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com yastatic.net; img-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.eponesh.com *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.net *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com yastatic.net; media-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.net *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com; object-src 'self' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com; script-src 'self' 'unsafe-eval' 'unsafe-inline' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.eponesh.com *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.gameanalytics.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.ya.ru *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com abt.s3.yandex.net allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de www.google-analytics.com www.googletagmanager.com ya.ru yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com yastatic.net; style-src 'self' 'unsafe-eval' 'unsafe-inline' *.allwebgames.com *.api.gameanalytics.com *.cdp.cloud.unity3d.com *.cloud-api.yandex.net *.firebase.googleapis.com *.firebasestorage.googleapis.com *.firestore.googleapis.com *.games-sdk.yandex.ru *.gametok.com *.gstatic.com *.hippogames.dev *.juegocasa.com *.oauth2.googleapis.com *.openidconnect.googleapis.com *.playhop.com *.playmelonpg.com *.s3.eu-central-1.amazonaws.com *.storage.yandex.net *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com api.gameanalytics.com blob: cdp.cloud.unity3d.com cloud-api.yandex.net data: firebase.googleapis.com firebasestorage.googleapis.com firestore.googleapis.com fonts.googleapis.com games-sdk.yandex.ru gametok.com gstatic.com hippogames.dev juegocasa.com oauth2.googleapis.com openidconnect.googleapis.com playhop.com playmelonpg.com s3.eu-central-1.amazonaws.com storage.yandex.net storage.yandexcloud.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com; worker-src 'self' *.allwebgames.com *.gametok.com *.juegocasa.com *.playhop.com *.website.yandexcloud.net *.wowspiele.de *.yandex.az *.yandex.by *.yandex.co.il *.yandex.com *.yandex.com.am *.yandex.com.ge *.yandex.com.tr *.yandex.ee *.yandex.fr *.yandex.kg *.yandex.kz *.yandex.lt *.yandex.lv *.yandex.md *.yandex.ru *.yandex.tj *.yandex.tm *.yandex.ua *.yandex.uz *.yango.com allwebgames.com blob: gametok.com juegocasa.com playhop.com storage.yandexcloud.net wowspiele.de yandex.az yandex.by yandex.co.il yandex.com yandex.com.am yandex.com.ge yandex.com.tr yandex.ee yandex.fr yandex.kg yandex.kz yandex.lt yandex.lv yandex.md yandex.ru yandex.tj yandex.tm yandex.ua yandex.uz yango.com" http-equiv="Content-Security-Policy"/>
<meta charset="utf-8"/>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="TemplateData/favicon.ico" rel="shortcut icon"/>
<link href="TemplateData/style.css" rel="stylesheet"/>
<!-- Yandex Games SDK -->
<script>
        function InitYandexSdk() {
            console.log('InitYandexSdk Enter');
            YaGames.init().then(ysdk => {
                console.log('Yandex SDK initialized');
                window.ysdk = ysdk;
            });
        }
    </script>
<script onload="InitYandexSdk()" src="/sdk.js"> </script>
<script src="./Modules/WebView/unity-webview.js"></script>
</head>
<body>
<div id="unity-container" style="height: 100%;">
<canvas height="600" id="unity-canvas" style="width: 100%; height: 100%" width="960"></canvas>
<div id="unity-loading-bar">
<div id="unity-progress-bar-empty">
<div id="unity-progress-bar-full"></div>
</div>
</div>
<div id="unity-warning"></div>
</div>
<script>
        var container = document.querySelector("#unity-container");
        var canvas = document.querySelector("#unity-canvas");
        var loadingBar = document.querySelector("#unity-loading-bar");
        var progressBarFull = document.querySelector("#unity-progress-bar-full");
        var warningBanner = document.querySelector("#unity-warning");

        var gameInstance = null;

        function unityShowBanner(msg, type) {
            function updateBannerVisibility() {
                warningBanner.style.display = warningBanner.children.length ? 'block' : 'none';
            }
            var div = document.createElement('div');
            div.innerHTML = msg;
            warningBanner.appendChild(div);
            if (type == 'error') div.style = 'background: red; padding: 10px;';
            else {
                if (type == 'warning') div.style = 'background: yellow; padding: 10px;';
                setTimeout(function () {
                    warningBanner.removeChild(div);
                    updateBannerVisibility();
                }, 5000);
            }
            updateBannerVisibility();
        }

        var dataFile = "/78_release-web-27.6.2-yandex_melon_webgl_cd50e1f8aacca9c939b3afcae6b2b2171c618f72_v27_6_2.data.unityweb";
        var canvasElement = document.createElement("canvas");
        var gl1 = canvasElement.getContext("webgl");
        var gl2 = canvasElement.getContext("webgl2");

        var gl;

        if (gl2) {
            console.log('Found GL2 Context ', gl2)
            gl = gl2;
        }
        else if (gl1) {
            console.log('Found GL1 Context ', gl1)
            gl = gl1;
        }

        //console.log('Supported Extension for GL',  gl.getSupportedExtensions())

        if ((gl && gl.getExtension('WEBGL_compressed_texture_astc'))) {
            console.log('WebGL ASTC extension Found! Switched')
            //dataFile = "/ASTC.data"; //Development Build
            //dataFile = "/ASTC.data.unityweb";
        }
        else {
            console.log('Switched to DXT')
            //dataFile = "/DXT.data"; //Development Build
            //dataFile = "/DXT.data.unityweb";
        }

        console.log('Result DATA File is', dataFile)
        var buildUrl = "Build";
        var loaderUrl = buildUrl + "/78_release-web-27.6.2-yandex_melon_webgl_cd50e1f8aacca9c939b3afcae6b2b2171c618f72_v27_6_2.loader.js";
        var config = {
            //dataUrl: buildUrl + "/78_release-web-27.6.2-yandex_melon_webgl_cd50e1f8aacca9c939b3afcae6b2b2171c618f72_v27_6_2.data.unityweb",
            dataUrl: buildUrl + dataFile,
            frameworkUrl: buildUrl + "/78_release-web-27.6.2-yandex_melon_webgl_cd50e1f8aacca9c939b3afcae6b2b2171c618f72_v27_6_2.framework.js.unityweb",
            codeUrl: buildUrl + "/78_release-web-27.6.2-yandex_melon_webgl_cd50e1f8aacca9c939b3afcae6b2b2171c618f72_v27_6_2.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "27 Studio",
            productName: "Melon Sandbox",
            productVersion: "27.6.2",
            showBanner: unityShowBanner,
        };


        if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            // Mobile device style: fill the whole browser client area with the game canvas:

            var meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
            document.getElementsByTagName('head')[0].appendChild(meta);
            container.className = "unity-mobile";
            canvas.className = "unity-mobile";

            // To lower canvas resolution on mobile devices to gain some
            // performance, uncomment the following line:
            config.devicePixelRatio = 1.2;

            //unityShowBanner('WebGL builds are not supported on mobile devices.');
        }

        loadingBar.style.display = "block";

        var script = document.createElement("script");
        script.src = loaderUrl;

        script.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
                progressBarFull.style.width = 100 * progress + "%";
            }).then((unityInstance) => {

                console.log('UnityInstance Created!', unityInstance);
                window.unityInstance = unityInstance;
                gameInstance = unityInstance;
                loadingBar.style.display = "none";
            }).catch((message) => {
                alert(message);
            });
        };

        document.body.appendChild(script);
    </script>
<script type="module">
        import { } from "./Modules/Firebase/firebase-app-compact-9.14.0.js";
        import { } from "./Modules/Firebase/firebase-firestore-compat-9.14.0.js";
        import { } from "./Modules/Firebase/firebase-analytics-8.10.1.js";
        import { } from "./Modules/Firebase/firebase-storage-8.10.1.js";
    </script>
<script src="./Modules/Lame/lame.all.js"></script>
<script>
        window.lamejs = lamejs;
    </script>
<script type="module">
        import { } from "./Modules/JQuery/jquery-3.1.0.min.js";
    </script>
<!-- BEGIN WEBGL FILE BROWSER LIB -->
<style>
    #fb_popup_background.highlight {
        border: 3px dashed #ccc;
        border-radius: 0px;
        border-color: aquamarine;
    }
    #fb_popup_header_img.highlight {
        border-top: 3px dashed #ccc;
        border-left: 3px dashed #ccc;
        border-right: 3px dashed #ccc;
        border-radius: 0px;
        border-color: aquamarine;
    }
    .disableSelection {
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        -o-user-select: none;
        user-select: none;
    }
</style>
<div id="fileBrowserPopup" style="display: none; margin: 0%; position: absolute; width: 100%; height: 100%; left: 0; top: 0; bottom: 0; right: 0;">
<img class="disableSelection" style="position: absolute; width: 100%; height: 100%; background-color: #000000; filter: opacity(0.7) blur(4px); "/>
<div id="fb_popup">
<img id="fb_popup_background" src="FileBrowser/popup_background.png" style="position: fixed; top: 0;  right: 0; bottom: 0; left: 0; margin: auto; width: 502.5px; height: 206px; outline-style: solid; outline-color: white; outline-width: 5px;"/>
<div>
<img id="fb_popup_header_img" src="FileBrowser/popup_header.png" style="position: fixed; top: -146px;  right: 0; bottom: 0; left: 0; margin: auto; width: 502.5px; height: 60.5px;"/>
<strong id="fb_popup_header_title" style="position: fixed; top: -110px;  right: -370px; bottom: 0; left: 0; margin: auto; width: 500px; height: 58px; color: white;">
                FILE BROWSER
            </strong>
</div>
<div id="open_file_form">
<strong id="fb_popup_description_title" style="position: fixed; top: 0px;  right: 0px; bottom: 0; left: 0; margin: auto; width: 500px; height: 58px; text-align: center; color: white;">
                SELECT FILE TO LOAD OR USE DRAG &amp; DROP
            </strong>
<label for="fileToUpload">
<img src="FileBrowser/select_button.png" style="position: fixed; top: 0px;  right: 250px; bottom: -80px; left: 0; margin: auto; width: 193.5px; height: 41px; outline-style: solid; outline-color: white; outline-width: 2px;"/>
<strong id="fb_popup_select_button_title" style="position: fixed; top: 0px;  right: 250px; bottom: -100px; left: 0; margin: auto; width: 193.5px; height: 41px; text-align: center; color: white;">
                    SELECT
                </strong>
</label>
<input id="fileToUpload" name="fileToUpload" onchange="fbLoadFiles(event.target.files);return false;" style="width: 0px; height: 0px;" type="file"/>
<label for="closePopup">
<img src="FileBrowser/close_button.png" style="position: fixed; top: 0px;  right: -250px; bottom: -80px; left: 0; margin: auto; width: 193.5px; height: 41px; outline-style: solid; outline-color: white; outline-width: 2px;"/>
<strong id="fb_popup_close_button_title" style="position: fixed; top: 0px;  right: -245px; bottom: -100px; left: 0; margin: auto; width: 193.5px; height: 41px; text-align: center; color: white;">
                    CLOSE
                </strong>
</label>
<input id="closePopup" name="closePopup" onclick="requestCloseFileBrowserForOpen()" style="width: 0px; height: 0px;" type="button"/>
</div>
</div>
</div>
<script type="text/javascript">
    // ************************ Drag and drop ***************** //
    let dropArea = document.getElementById("fb_popup");
    let dropAreaBG = document.getElementById("fb_popup_background");
    let headerArea = document.getElementById("fb_popup_header_img")

    // Prevent default drag behaviors
    ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    })

    // Highlight drop area when item is dragged over it
    ;['dragenter', 'dragover'].forEach(eventName => {
        dropArea.addEventListener(eventName, highlight, false);
    })

    ;['dragleave', 'drop'].forEach(eventName => {
        dropArea.addEventListener(eventName, unhighlight, false);
    })

    // Handle dropped files
    dropArea.addEventListener('drop', handleDrop, false);

    function preventDefaults (e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function highlight(e) {
        dropAreaBG.classList.add('highlight');
        headerArea.classList.add('highlight');
    }

    function unhighlight(e) {
        dropAreaBG.classList.remove('highlight');
        headerArea.classList.remove('highlight');
    }

    function handleDrop(e) {
        var dt = e.dataTransfer;
        var items = dt.items;

        getFilesDataTransferItems(items).then(files => {
            fbLoadFiles(files);
        });
    }

    function getFilesDataTransferItems(dataTransferItems) {
        function traverseFileTreePromise(item, path = "", files) {
            return new Promise(resolve => {
                if (item.isFile) {
                    item.file(file => {
                        files.push(file);
                        resolve(file);
                    });
                } else if (item.isDirectory) {
                    let dirReader = item.createReader();
                    dirReader.readEntries(entries => {
                        let entriesPromises = [];
                        for (let entr of entries)
                            entriesPromises.push(
                                traverseFileTreePromise(entr, (path || "") + item.name + "/", files)
                            );
                        resolve(Promise.all(entriesPromises));
                    });
                }
            });
        }

        let files = [];
        return new Promise((resolve, reject) => {
            let entriesPromises = [];
            for (let it of dataTransferItems)
                entriesPromises.push(
                    traverseFileTreePromise(it.webkitGetAsEntry(), null, files)
                );
            Promise.all(entriesPromises).then(entries => {
                resolve(files);
            });
        });
    }
</script>
<script type="text/javascript">
    function callFBFunctionByName(functionName, parameter){
        switch(functionName){
            case "initializeFBLibrary":
                initializeFBLibrary();
                break;
            case "openFileBrowserForLoad":
                openFileBrowserForLoad(parameter);
                break;
            case "cleanupFB":
                cleanupFB();
                break;       
            case "closeFileBrowserForOpen":
                closeFileBrowserForOpen();
                break;
            case "saveFile":
                saveFileFB(parameter);
                break;
            case "setLocalization":
                setLocalizationFB(parameter);
                break;
        }
    }
    document.callFBFunctionByName = callFBFunctionByName;

    function initializeFBLibrary(){
        document.fbPopup = document.getElementById("fileBrowserPopup");
        document.fbOpenFilePopupInput = document.getElementById("fileToUpload");

        document.fbStorage = { 
            initialized: true,
            loadedFiles: {},
            dataPointers: []
        };
    }

    function openFileBrowserForLoad(parameters){
        if(document.fbStorage.initialized !== true)
            return;

        var typesFilter = parameters[0];
        var isMultipleSelection = parameters[1] === 1 ? true : false;
        var isFolder = parameters[2] === 1 ? true : false;

        if(document.fbOpenFilePopupInput.hasAttribute('multiple'))
            document.fbOpenFilePopupInput.removeAttribute('multiple');

        if (document.fbOpenFilePopupInput.hasAttribute('webkitdirectory'))
            document.fbOpenFilePopupInput.removeAttribute('webkitdirectory');

        if(isMultipleSelection && !isFolder)
            document.fbOpenFilePopupInput.setAttribute('multiple', '');

        if(isFolder)
            document.fbOpenFilePopupInput.setAttribute('webkitdirectory', '');

        document.fbOpenFilePopupInput.accept = typesFilter;
        document.fbPopup.style.display = "flex";
    }

    function closeFileBrowserForOpen(){
        if(document.fbStorage.initialized !== true)
            return;
        document.fbPopup.style.display = "none";
    }

    function cleanupFB() {
        if(document.fbStorage.initialized !== true)
            return;
        document.fbStorage.loadedFiles = {};
        document.fbStorage.dataPointers = [];
    }

    function saveFileFB(fileData){
        if(document.fbStorage.initialized !== true)
            return;

        let fileInfo = {
            status: true,
            message: "",
            name: fileData.name
        };

        try{
            var contentType = 'application/octet-stream';
            var a = document.createElement('a');
            var blob = new Blob([fbBase64ToBytesArray(fileData.data)], {
                'type': contentType
            });
            a.href = window.URL.createObjectURL(blob);
            a.download = fileData.name;

            if (document.createEvent) {
                var event = document.createEvent('MouseEvents');
                event.initEvent('click', true, true);
                a.dispatchEvent(event);
            } else {
                a.click();
            }

            gameInstance.SendMessage(libraryHandlerObjectName, "HandleFileSaved", JSON.stringify(fileInfo));
        }
        catch(ex){
            fileInfo.status = false;
            fileInfo.message = ex.message;

            gameInstance.SendMessage(libraryHandlerObjectName, "HandleFileSaved", JSON.stringify(fileInfo));
        }
    }

    const libraryHandlerObjectName = "[FGFileBrowser]";

    function fbLoadFiles(files) {
        gameInstance.SendMessage(libraryHandlerObjectName, 'SetAmountOfFilesToBeLoaded', Array.from(files).filter(item => !item.name.endsWith(".DS_Store")).length);

        for (var i = 0, f; f = files[i]; i++) {
            // ignore Mac hidden file
            if (f.name.endsWith(".DS_Store"))
                continue;

            var reader = new FileReader();
            reader.onload = (function (file) {
                return function (fileloadEvent) {
                    let loadedFileInfo = fileloadEvent.target.result;
            
                    document.fbStorage.loadedFiles[file.name] = {
                        info: loadedFileInfo
                    };

                    let extensionSplit = file.name.split('.');
                    let extension = extensionSplit[extensionSplit.length - 1];
                    let name = file.name.replace(extension, "");
                    name = name.substring(0, name.length - 1);

                    let loadedFile = {
                        fullName: file.name,
                        name: name,
                        path: "unavailable-in-web",
                        length: loadedFileInfo.byteLength,
                        size: file.size,
                        extension: extension
                    };

                    gameInstance.SendMessage(libraryHandlerObjectName, 'HandleLoadedFile', JSON.stringify(loadedFile));
                }
            })(f);
            
            reader.readAsArrayBuffer(f);
        }
        document.fbOpenFilePopupInput.value = "";
    }

    function requestCloseFileBrowserForOpen() {
        gameInstance.SendMessage(libraryHandlerObjectName, "CloseFileBrowserForOpen");
    }

    function fbBase64ToBytesArray(base64) {
        var binary_string = window.atob(base64);
        var len = binary_string.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binary_string.charCodeAt(i);
        }
        return bytes.buffer;
    }

    function setLocalizationFB(parameter){
        switch(parameter.key){
            case "HEADER_TITLE":
                document.getElementById("fb_popup_header_title").innerHTML = parameter.value;
                break;
            case "DESCRIPTION_TEXT":
                document.getElementById("fb_popup_description_title").innerHTML = parameter.value;
                break;
            case "SELECT_BUTTON_CONTENT":
                document.getElementById("fb_popup_select_button_title").innerHTML = parameter.value;
                break;
            case "CLOSE_BUTTON_CONTENT":
                document.getElementById("fb_popup_close_button_title").innerHTML = parameter.value;
                break;
        }
    }

</script>
<!-- END WEBGL FILE BROWSER LIB -->
<script>
    if (window.top === window.self) {
    window.location.href = '../../../';
}
</script></body>
</html>
